<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus Helper</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Quicksand:wght@500;700&display=swap');
        
        :root { 
            --accent: #4a90e2; 
            --bg: #f8f9fa; 
            --panel: #ffffff;
            --text: #2d3436;
            --border: #e1e4e8; 
        }

        body { 
            margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* ‚òÅÔ∏è GENTLE FEEDBACK */
        @keyframes gentle-pulse {
            0% { box-shadow: 0 4px 12px rgba(74, 144, 226, 0.1); }
            50% { box-shadow: 0 8px 24px rgba(74, 144, 226, 0.3); }
            100% { box-shadow: 0 4px 12px rgba(74, 144, 226, 0.1); }
        }
        .thinking-active #imageFrame { animation: gentle-pulse 2s infinite ease-in-out; border-color: var(--accent); }

        /* MODEST LAYOUT */
        .top-nav { 
            height: 60px; background: #fff; border-bottom: 1px solid var(--border); 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 0 20px; z-index: 100;
        }

        .studio-core { display: grid; grid-template-columns: 340px 1fr; flex: 1; overflow: hidden; }
        
        .sidebar { background: #fff; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        
        .tab-btn { 
            flex: 1; background: transparent; border: none; color: #95a5a6; 
            font-family: 'Quicksand', sans-serif; font-size: 14px; padding: 15px 0; 
            cursor: pointer; transition: 0.3s; border-bottom: 2px solid transparent;
        }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        .tab-content { padding: 25px; display: none; overflow-y: auto; flex: 1; }
        .tab-content.active { display: block; }

        .preview-area { background: #f0f2f5; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 20px; }
        
        #imageFrame { 
            width: 100%; max-width: 512px; aspect-ratio: 1/1; 
            border: 2px solid #fff; background: #fff; 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); overflow: hidden;
            transition: 0.5s;
        }
        #mainImg { max-width: 100%; height: auto; border-radius: 8px; display: none; }

        /* üè† FRIENDLY LOGIN */
        #gatekeeper { position: fixed; inset: 0; background: #fff; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .login-card { text-align: center; width: 90%; max-width: 360px; }
        .brand-main { font-family: 'Quicksand'; font-size: 32px; font-weight: 700; color: var(--accent); margin-bottom: 5px; }
        .brand-sub { font-size: 14px; color: #7f8c8d; margin-bottom: 30px; }
        
        .info-box { text-align: left; background: #f8f9fa; border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-bottom: 25px; font-size: 13px; color: #636e72; line-height: 1.6; }

        input, textarea, select { 
            width: 100%; background: #fdfdfd; border: 1px solid var(--border); color: var(--text); 
            padding: 12px; border-radius: 10px; font-size: 14px; margin-top: 8px; box-sizing: border-box;
        }

        .btn-gen { 
            background: var(--accent); color: #fff; border: none; 
            font-family: 'Quicksand'; font-weight: 700; padding: 14px; 
            border-radius: 10px; cursor: pointer; transition: 0.2s; width: 100%;
        }
        .btn-gen:hover { opacity: 0.9; transform: scale(1.02); }

        /* STATUS DOT */
        .status-pill { font-size: 10px; background: #eee; padding: 4px 10px; border-radius: 20px; display: inline-flex; align-items: center; gap: 5px; }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: #2ecc71; }
    </style>
</head>
<body>

    <audio id="bgAudio" loop src="ambient.wav"></audio>

    <div id="gatekeeper">
        <div class="login-card">
            <div class="brand-main">Nexus</div>
            <div class="brand-sub">Your Creative Suite</div>
            
            <div class="info-box">
                Hello! I'm here to help you turn your ideas into images. This suite is designed to be a simple, private space for your projects. 
                <br><br>
                ‚ú® <b>Create</b> with words<br>
                ‚ú® <b>Refine</b> your style<br>
                ‚ú® <b>Save</b> for later
            </div>

            <input type="password" id="passInput" placeholder="Enter your passkey..." style="text-align:center;">
            <button class="btn-gen" style="margin-top:20px;" onclick="unlock()">Let's Start</button>
        </div>
    </div>

    <header class="top-nav">
        <div style="font-family:Quicksand; font-weight:700; color:var(--accent); font-size:20px;">Nexus</div>
        <div style="display:flex; gap:15px; align-items:center;">
            <div class="status-pill"><div class="dot"></div> Ready</div>
            <button onclick="toggleSettings()" style="background:none; border:none; cursor:pointer; font-size:18px; opacity:0.4;">‚öôÔ∏è</button>
        </div>
    </header>

    <main class="studio-core">
        <div class="sidebar">
            <div style="display:flex; border-bottom:1px solid var(--border);">
                <button class="tab-btn active" id="btn-create" onclick="switchTab('create')">Create</button>
                <button class="tab-btn" id="btn-collection" onclick="switchTab('collection')">Collection</button>
                <button class="tab-btn" id="btn-about" onclick="switchTab('about')">About</button>
            </div>
            
            <div id="tab-create" class="tab-content active">
                <label style="font-weight:600; font-size:13px; color:#636e72;">What are we making today?</label>
                <textarea id="promptIn" rows="4" placeholder="e.g., A cozy cabin in the woods..."></textarea>
                <button class="btn-gen" style="margin-top:20px;" onclick="generate()">Create Image</button>
            </div>

            <div id="tab-collection" class="tab-content">
                <div id="historyGrid" style="display:grid; grid-template-columns:1fr 1fr; gap:12px;"></div>
                <button onclick="selfDestruct()" style="width:100%; margin-top:20px; background:none; border:none; color:#d63031; font-size:11px; cursor:pointer;">[ Tidy up and logout ]</button>
            </div>

            <div id="tab-about" class="tab-content">
                <div style="font-family:Quicksand; font-weight:700; margin-bottom:10px;">Hi, I'm Nexus.</div>
                <p style="font-size:14px; color:#636e72; line-height:1.6;">
                    I'm a personal AI assistant built to make image generation easy and accessible. Whether you're a designer or just exploring, I'm happy to help!
                </p>
                <p style="font-size:12px; color:#b2bec3;">Version 5.0 ‚Ä¢ Personal Edition</p>
            </div>
        </div>

        <div class="preview-area">
            <div id="imageFrame">
                <div id="waitText" style="color:#b2bec3; font-weight:500;">Ready when you are.</div>
                <img id="mainImg">
            </div>
            <button id="dlBtn" class="btn-gen" style="display:none; margin-top:20px; width:180px; background:#fff; color:var(--accent); border:1px solid var(--accent);" onclick="download()">Save Image</button>
        </div>
    </main>

    <script>
        const MASTER_KEY = "NEXUS77";
        let FORGE_URL = sessionStorage.getItem('nexus_url') || "";
        let sessionHistory = [];

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active');
            document.getElementById('btn-'+tab).classList.add('active');
        }

        function unlock() {
            if(document.getElementById('passInput').value.toUpperCase() === MASTER_KEY) {
                document.getElementById('gatekeeper').style.display = 'none';
                document.getElementById('bgAudio').volume = 0.05;
                document.getElementById('bgAudio').play().catch(() => {});
            }
        }

        async function generate() {
            if(!FORGE_URL) return alert("Please set your link in settings ‚öôÔ∏è");
            document.body.classList.add('thinking-active');
            document.getElementById('waitText').innerText = "Working on it...";
            
            try {
                const res = await fetch(`${FORGE_URL}/sdapi/v1/txt2img`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({
                        "prompt": document.getElementById('promptIn').value,
                        "steps": 20
                    })
                });
                const data = await res.json();
                const b64 = "data:image/png;base64," + data.images[0];
                const img = document.getElementById('mainImg');
                img.src = b64;
                img.style.display = "block";
                document.getElementById('waitText').style.display = "none";
                document.getElementById('dlBtn').style.display = "block";
                
                sessionHistory.unshift(b64);
                renderHistory();
            } catch(e) { alert("Something went wrong with the connection."); }
            document.body.classList.remove('thinking-active');
        }

        function renderHistory() {
            const grid = document.getElementById('historyGrid');
            grid.innerHTML = "";
            sessionHistory.slice(0, 6).forEach(src => {
                const div = document.createElement('div');
                div.style = "border:1px solid #eee; aspect-ratio:1; border-radius:8px; background:url("+src+"); background-size:cover; cursor:pointer;";
                div.onclick = () => { document.getElementById('mainImg').src = src; };
                grid.appendChild(div);
            });
        }

        function toggleSettings() {
            let url = prompt("Link to Forge:", FORGE_URL);
            if(url) { FORGE_URL = url; sessionStorage.setItem('nexus_url', url); }
        }

        function download() {
            const a = document.createElement('a'); a.href = document.getElementById('mainImg').src;
            a.download = "nexus-creation.png"; a.click();
        }

        function selfDestruct() {
            if(confirm("Clear your current images and logout?")) {
                sessionStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
