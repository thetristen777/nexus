<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>NEXUS | OMEGA v4.2 SECURE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600&display=swap');
        
        :root { 
            --accent: #00d2ff; 
            --accent-dim: rgba(0, 210, 255, 0.1);
            --bg: #020204; 
            --panel: #08090d;
            --border: rgba(0, 210, 255, 0.2); 
            --text-muted: #666;
        }

        /* üß† NEURAL FEEDBACK ANIMATION */
        @keyframes neural-pulse {
            0% { --accent: #00d2ff; filter: hue-rotate(0deg); }
            50% { --accent: #ff00d2; filter: hue-rotate(140deg) brightness(1.2); }
            100% { --accent: #00d2ff; filter: hue-rotate(0deg); }
        }

        .thinking-active { animation: neural-pulse 1.5s infinite; cursor: wait !important; }
        .thinking-active .crt-overlay { background-size: 100% 4px, 6px 100% !important; opacity: 0.4; }

        body { 
            margin: 0; background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        .crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 2px, 3px 100%;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
        }

        /* Standard Layout Styles */
        .top-nav { height: 60px; background: #000; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-shrink: 0; }
        .studio-core { display: grid; grid-template-columns: 380px 1fr; flex: 1; overflow: hidden; }
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
        .tab-header { display: flex; border-bottom: 1px solid var(--border); background: #000; }
        .tab-btn { flex: 1; background: transparent; border: none; color: #555; font-family: 'Orbitron'; font-size: 9px; padding: 15px 0; cursor: pointer; transition: 0.3s; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); background: var(--accent-dim); }
        .tab-content { padding: 20px; overflow-y: auto; flex: 1; padding-bottom: 150px; display: none; opacity: 0; transform: translateY(10px); transition: 0.3s; }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }
        .preview-area { background: #000; position: relative; display: flex; align-items: center; justify-content: flex-start; flex-direction: column; overflow-y: auto; padding: 40px 20px 150px 20px; }
        
        @media (max-width: 850px) {
            .studio-core { grid-template-columns: 1fr; display: block; overflow-y: auto; }
            .sidebar { border-right: none; height: auto; border-bottom: 1px solid var(--border); max-height: 60vh; } 
        }

        /* Buttons & UI */
        .btn-gen { background: var(--accent); color: #000; border: none; font-family: 'Orbitron'; font-weight: 900; padding: 15px; cursor: pointer; width: 100%; margin: 15px 0; border-radius: 4px; box-shadow: 0 0 15px rgba(0,210,255,0.3); }
        .btn-gen:disabled { background: #222; color: #444; cursor: not-allowed; }
        .btn-opt { background: #111; border: 1px solid #333; color: #aaa; padding: 10px; font-size: 10px; font-family: 'Orbitron'; cursor: pointer; transition: 0.2s; }
        .btn-opt.active { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }
        
        select, textarea, input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; margin: 5px 0; box-sizing: border-box; border-radius: 4px; font-family: 'Inter'; }
        label { font-family: 'Orbitron'; font-size: 9px; color: var(--accent); margin-top: 20px; display: block; letter-spacing: 1px; }
        
        #mainImg { max-width: 100%; height: auto; border: 1px solid var(--border); display: none; margin-bottom: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        #placeholder { font-family: 'Orbitron'; opacity: 0.2; letter-spacing: 5px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.1; } 50% { opacity: 0.3; } }

        #gatekeeper { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        footer { height: 40px; background: #000; border-top: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; font-family: 'Orbitron'; font-size: 7px; color: var(--accent); }
    </style>
</head>
<body class="secure-mode">

    <audio id="bgAudio" loop src="ambient.wav"></audio>
    <div class="crt-overlay"></div>

    <div id="gatekeeper">
        <div style="text-align: center; border: 1px solid var(--accent); padding: 40px; background: #050508; width: 80%; max-width: 300px; box-shadow: 0 0 50px rgba(0,210,255,0.1);">
            <div style="font-family:Orbitron; color:var(--accent); font-weight:900; margin-bottom:10px; font-size: 18px;">NEXUS <span style="font-weight:100">OMEGA</span></div>
            <div style="font-size: 9px; color: #555; margin-bottom: 20px;">V4.2 // ENCRYPTED TERMINAL</div>
            <input type="password" id="passInput" style="text-align:center; font-family:Orbitron; font-size:16px; margin:20px 0;" placeholder="ENTER PASSKEY">
            <div id="lockStatus" style="font-family:Orbitron; font-size:8px; color:#f00; height:10px; margin-bottom:10px;"></div>
            <button class="btn-gen" id="initBtn" onclick="unlock()">INITIALIZE</button>
        </div>
    </div>

    <header class="top-nav">
        <div style="font-family:Orbitron; color:var(--accent); font-weight:900; font-size:14px;">NEXUS <span style="font-size:8px; opacity:0.5;">V4.2</span></div>
        <div style="display:flex; align-items:center; gap:15px;">
            <div style="font-family:Orbitron; font-size:10px; color:var(--accent); display:none;" id="volControls">
                VOL <input type="range" id="volSlider" min="0" max="1" step="0.05" value="0.10" oninput="updateVolume(this.value)" style="width:40px; vertical-align:middle;">
            </div>
            <button onclick="toggleSettings()" style="background:none; border:none; cursor:pointer; font-size: 16px;">‚öôÔ∏è</button>
        </div>
    </header>

    <div id="settingsBox" style="display:none; position:fixed; top:70px; right:20px; background:#0a0b10; border:1px solid var(--accent); padding:20px; z-index:5000; width:280px;">
        <label>NEURAL UPLINK (API)</label>
        <input type="text" id="urlInput">
        <button class="btn-gen" style="padding:10px; font-size:10px;" onclick="saveURL()">SAVE CONFIG</button>
    </div>

    <main class="studio-core">
        <div class="sidebar">
            <div class="tab-header">
                <button class="tab-btn active" onclick="switchTab('neural')">NEURAL</button>
                <button class="tab-btn" onclick="switchTab('archive')">ARCHIVE</button>
                <button class="tab-btn" onclick="switchTab('about')">IDENTITY</button>
            </div>

            <div id="tab-neural" class="tab-content active">
                <label>STEERING MODE</label>
                <select id="stylePreset">
                    <option value="">RAW SYNTHESIS</option>
                    <option value=", highly detailed, 8k, photorealistic, cinematic lighting">PHOTOREAL</option>
                    <option value=", cyberpunk style, neon lights, intricate mechanical detail">CYBERPUNK</option>
                    <option value=", ethereal, dreamlike, soft focus, masterwork">ETHEREAL</option>
                </select>

                <label>VISION PROMPT</label>
                <textarea id="promptIn" rows="3" placeholder="Input neural data..."></textarea>
                <button class="btn-opt" style="margin-top:5px; width:100%; border-style:dashed;" onclick="randomPrompt()">üé≤ RANDOMIZE</button>

                <label>ASPECT RATIO</label>
                <div style="display:flex; gap:5px;">
                    <button class="btn-opt active" style="flex:1" onclick="setRatio(this, 512, 512)">1:1</button>
                    <button class="btn-opt" style="flex:1" onclick="setRatio(this, 512, 768)">2:3</button>
                    <button class="btn-opt" style="flex:1" onclick="setRatio(this, 768, 512)">3:2</button>
                </div>

                <label>CFG SCALE</label>
                <input type="range" id="cfgScale" min="1" max="20" value="7">

                <button class="btn-gen" onclick="generate()">INITIATE SYNTHESIS</button>
                <div id="consoleLog" style="margin-top:20px; font-family:'Orbitron'; font-size:8px; color:#444;"></div>
            </div>

            <div id="tab-archive" class="tab-content">
                <div id="historyGrid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
            </div>

            <div id="tab-about" class="tab-content">
                <div style="font-family:'Orbitron'; color:var(--accent); font-size:12px; margin-bottom:15px;">// SYSTEM ARCHITECT: TRISTEN</div>
                <div style="font-size:13px; color:#ccc; border-left:2px solid var(--accent); padding-left:15px;">
                    Welcome to NEXUS. Secure neural interface established.
                </div>
            </div>
        </div>

        <div class="preview-area">
            <div id="placeholder">SYSTEM STANDBY</div>
            <img id="mainImg" src="">
            <button id="dlBtn" class="btn-opt" style="display:none; margin-top:20px; width:220px;" onclick="downloadImg()">üíæ SAVE ARTIFACT</button>
        </div>
    </main>

    <footer>
        <div>UPLINK: <span id="statusTag">OFFLINE</span></div>
        <div style="opacity:0.5;">SECURE SESSION ACTIVE</div>
    </footer>

    <script>
        const MASTER_KEY = "NEXUS77";
        let FORGE_URL = sessionStorage.getItem('nexus_url') || ""; // SECURITY: SESSION ONLY
        let currentW = 512, currentH = 512;

        function log(msg) {
            const entry = document.createElement('div');
            entry.innerText = `> ${new Date().toLocaleTimeString()}: ${msg}`;
            document.getElementById('consoleLog').prepend(entry);
        }

        function unlock() {
            const btn = document.getElementById('initBtn');
            const status = document.getElementById('lockStatus');
            
            if(document.getElementById('passInput').value.toUpperCase() === MASTER_KEY) {
                document.getElementById('gatekeeper').style.fadeOut = "0.5s";
                setTimeout(() => document.getElementById('gatekeeper').style.display = 'none', 500);
                document.getElementById('volControls').style.display = 'block';
                const audio = document.getElementById('bgAudio');
                audio.volume = 0.10; 
                audio.play();
                log("ENCRYPTED LINK ESTABLISHED.");
            } else {
                // SECURITY: BRUTE FORCE DELAY
                status.innerText = "ACCESS DENIED - COOLDOWN ACTIVE";
                btn.disabled = true;
                setTimeout(() => { btn.disabled = false; status.innerText = ""; }, 3000);
            }
        }

        async function generate() {
            if(!FORGE_URL) return alert("Configure Uplink in Settings.");
            
            // FEEDBACK ON
            document.body.classList.add('thinking-active');
            log("SYNTHESIZING NEURAL DATA...");
            
            const payload = {
                "prompt": document.getElementById('promptIn').value + document.getElementById('stylePreset').value,
                "steps": 20, "width": currentW, "height": currentH,
                "cfg_scale": document.getElementById('cfgScale').value
            };

            try {
                const res = await fetch(`${FORGE_URL}/sdapi/v1/txt2img`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                const img = document.getElementById('mainImg');
                img.src = "data:image/png;base64," + data.images[0];
                img.style.display = "block";
                document.getElementById('placeholder').style.display = "none";
                document.getElementById('dlBtn').style.display = "block";
                log("SYNTHESIS SUCCESSFUL.");
            } catch(e) { log("UPLINK ERROR."); }
            
            // FEEDBACK OFF
            document.body.classList.remove('thinking-active');
        }

        function toggleSettings() { 
            const s = document.getElementById('settingsBox'); 
            s.style.display = s.style.display === 'none' ? 'block' : 'none'; 
            document.getElementById('urlInput').value = FORGE_URL;
        }

        function saveURL() { 
            FORGE_URL = document.getElementById('urlInput').value; 
            sessionStorage.setItem('nexus_url', FORGE_URL); // SECURITY: DOESN'T SURVIVE TAB CLOSE
            toggleSettings(); 
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function setRatio(btn, w, h) {
            document.querySelectorAll('#tab-neural .btn-opt').forEach(b => b.classList.remove('active'));
            btn.classList.add('active'); currentW = w; currentH = h;
        }

        function randomPrompt() {
            const ideas = ["Cyberpunk city", "Mechanical dragon", "Space station", "Neon forest"];
            document.getElementById('promptIn').value = ideas[Math.floor(Math.random()*ideas.length)];
        }

        function downloadImg() {
            const a = document.createElement('a'); a.href = document.getElementById('mainImg').src;
            a.download = `artifact_${Date.now()}.png`; a.click();
        }
    </script>
</body>
</html>
