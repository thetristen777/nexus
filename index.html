<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>NEXUS | T.K. Industries</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600&display=swap');
        :root { --accent: #00d2ff; --bg: #020204; --border: rgba(0, 210, 255, 0.2); }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .top-nav { height: 60px; background: #000; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .studio-core { display: grid; grid-template-columns: 350px 1fr; flex: 1; overflow: hidden; }
        .sidebar { background: #08090d; border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; }
        .preview-area { background: #000; position: relative; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        
        @media (max-width: 768px) {
            .studio-core { grid-template-columns: 1fr; display: block; overflow-y: auto; }
            .sidebar { width: 100%; }
        }

        .btn-gen { background: var(--accent); color: #000; border: none; font-family: 'Orbitron'; font-weight: 900; padding: 15px; cursor: pointer; width: 100%; margin: 10px 0; border-radius: 4px; transition: 0.2s; }
        .btn-gen:hover { background: #fff; box-shadow: 0 0 20px var(--accent); }
        .btn-opt { flex: 1; background: #111; border: 1px solid var(--border); color: #fff; padding: 8px; font-size: 10px; font-family: 'Orbitron'; cursor: pointer; }
        .btn-opt.active { border-color: var(--accent); color: var(--accent); background: rgba(0,210,255,0.1); }
        
        select, textarea, input { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; margin: 5px 0; box-sizing: border-box; border-radius: 4px; }
        label { font-family: 'Orbitron'; font-size: 9px; color: var(--accent); margin-top: 15px; display: block; letter-spacing: 1px; }
        
        .security-log { position: absolute; bottom: 10px; left: 10px; width: 200px; font-family: 'Orbitron'; font-size: 7px; color: var(--accent); opacity: 0.7; }
        #mainImg { max-width: 90%; max-height: 60vh; border: 1px solid var(--border); display: none; }
        #gatekeeper { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <audio id="bgAudio" loop src="ambient.wav?v=1.1"></audio>

    <div id="gatekeeper">
        <div style="text-align: center; border: 1px solid var(--accent); padding: 40px; background: #050508;">
            <div style="font-family:Orbitron; color:var(--accent); font-weight:900; margin-bottom:10px;">NEXUS SYSTEM</div>
            <input type="password" id="passInput" style="text-align:center; font-family:Orbitron; font-size:20px; margin:20px 0;" placeholder="PASSKEY">
            <button class="btn-gen" onclick="unlock()">AUTHORIZE ACCESS</button>
        </div>
    </div>

    <header class="top-nav">
        <div style="font-family:Orbitron; color:var(--accent); font-weight:900; font-size:14px;">NEXUS <span style="font-size:8px; opacity:0.5;">V3.6 (AUTO-REFRESH)</span></div>
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-family:Orbitron; font-size:10px; color:var(--accent);">VOL: <span id="volLevel">2</span></div>
            <input type="range" min="0" max="1" step="0.05" value="0.10" oninput="updateVolume(this.value)" style="width:60px; accent-color:var(--accent);">
            <button onclick="toggleSettings()" style="background:none; border:none; cursor:pointer;">‚öôÔ∏è</button>
        </div>
    </header>

    <div id="settingsBox" style="display:none; position:fixed; top:70px; right:20px; background:#0a0b10; border:1px solid var(--accent); padding:20px; z-index:5000; width:280px;">
        <label>NEURAL UPLINK</label>
        <input type="text" id="urlInput" placeholder="https://....gradio.live">
        <button class="btn-gen" onclick="saveURL()">SAVE CONFIG</button>
    </div>

    <main class="studio-core">
        <div class="sidebar">
            <label>STEERING MODE</label>
            <select id="stylePreset">
                <option value="">RAW SYNTHESIS</option>
                <option value=", highly detailed, 8k, photorealistic, cinematic lighting">PHOTOREAL</option>
                <option value=", cyberpunk style, neon lights, intricate mechanical detail, synthwave">CYBERPUNK</option>
                <option value=", ethereal, dreamlike, soft focus, masterwork, digital art">ETHEREAL</option>
            </select>

            <label>VISION PROMPT</label>
            <textarea id="promptIn" rows="3" placeholder="Enter vision..."></textarea>
            
            <button class="btn-opt" style="margin-top:5px; background:#1a1a1a;" onclick="randomPrompt()">üé≤ SURPRISE ME</button>

            <label>ASPECT RATIO</label>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button class="btn-opt active" onclick="setRatio(this, 512, 512)">1:1</button>
                <button class="btn-opt" onclick="setRatio(this, 512, 768)">2:3</button>
                <button class="btn-opt" onclick="setRatio(this, 768, 512)">3:2</button>
            </div>

            <label>NEURAL INTENSITY</label>
            <input type="range" id="cfgScale" min="1" max="20" value="7" style="accent-color:var(--accent);">

            <div style="display:flex; align-items:center; gap:10px; margin: 15px 0;">
                <input type="checkbox" id="upscale" style="width:20px;">
                <label style="margin:0;">HI-RES ENHANCE (2X)</label>
            </div>

            <button class="btn-gen" onclick="generate()">EXECUTE SYNTHESIS</button>
            <div id="sidebarLog" style="font-size:7px; color:#444; font-family:Orbitron; line-height:1.5; margin-top:20px;"></div>
        </div>

        <div class="preview-area">
            <div id="placeholder" style="font-family:Orbitron; opacity:0.1; letter-spacing:5px;">SYSTEM STANDBY</div>
            <img id="mainImg" src="">
            <button id="dlBtn" class="btn-opt" style="display:none; margin-top:20px; width:200px;" onclick="downloadImg()">üíæ SAVE ARTIFACT</button>
            <div id="secLog" class="security-log"></div>
        </div>
    </main>

    <footer style="height:40px; background:#000; border-top:1px solid var(--border); display:flex; align-items:center; padding:0 20px; justify-content:space-between; font-family:Orbitron; font-size:7px; color:var(--accent);">
        <div>UPLINK: <span id="statusTag">OFFLINE</span></div>
        <div style="opacity:0.5;">POWERED BY GEMINI | T.K. INDUSTRIES</div>
    </footer>

    <script>
        const DEFAULT_UPLINK = "PASTE_YOUR_LINK_HERE"; 
        const MASTER_KEY = "NEXUS77";

        let FORGE_URL = localStorage.getItem('nexus_url') || DEFAULT_UPLINK || "";
        let currentW = 512, currentH = 512;

        const randomIdeas = [
            "A futuristic city built inside a giant glass dome on Mars",
            "A robotic knight kneeling in a garden of glowing flowers",
            "A portrait of a person with liquid gold skin and neon eyes",
            "A massive space station shaped like a DNA strand",
            "A cyberpunk street market in the rain at night",
            "A floating island with waterfalls falling into the clouds"
        ];

        function randomPrompt() {
            const idea = randomIdeas[Math.floor(Math.random() * randomIdeas.length)];
            document.getElementById('promptIn').value = idea;
        }

        function addLog(msg) {
            const entry = document.createElement('div');
            entry.innerText = `> ${new Date().toLocaleTimeString()}: ${msg}`;
            document.getElementById('secLog').prepend(entry);
        }

        function unlock() {
            if(document.getElementById('passInput').value.toUpperCase() === MASTER_KEY) {
                document.getElementById('gatekeeper').style.display = 'none';
                const audio = document.getElementById('bgAudio');
                audio.volume = 0.10; 
                audio.play().catch(e => console.log("User must interact"));
                addLog("ACCESS GRANTED");
                if(FORGE_URL && FORGE_URL !== "PASTE_YOUR_LINK_HERE") {
                    document.getElementById('statusTag').innerText = "STABLE";
                    document.getElementById('statusTag').style.color = "#00ff88";
                }
            }
        }

        function updateVolume(v) { document.getElementById('bgAudio').volume = v; document.getElementById('volLevel').innerText = Math.round(v*20); }
        function toggleSettings() { const s = document.getElementById('settingsBox'); s.style.display = s.style.display === 'none' ? 'block' : 'none'; }
        function saveURL() { FORGE_URL = document.getElementById('urlInput').value; localStorage.setItem('nexus_url', FORGE_URL); toggleSettings(); }
        function setRatio(btn, w, h) {
            document.querySelectorAll('.btn-opt').forEach(b => b.classList.remove('active'));
            btn.classList.add('active'); currentW = w; currentH = h;
        }

        async function generate() {
            if(!FORGE_URL || FORGE_URL === "https://ca52b0ad1763dbfd61.gradio.live") return alert("Link Missing.");
            addLog("SYNTHESIZING...");
            document.getElementById('placeholder').innerText = "PROCESSING...";
            
            const payload = {
                "prompt": document.getElementById('promptIn').value + document.getElementById('stylePreset').value,
                "steps": 20, "width": currentW, "height": currentH,
                "cfg_scale": document.getElementById('cfgScale').value,
                "enable_hr": document.getElementById('upscale').checked,
                "hr_scale": 2, "hr_upscaler": "R-ESRGAN 4x+"
            };

            try {
                const res = await fetch(`${FORGE_URL}/sdapi/v1/txt2img`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                const img = document.getElementById('mainImg');
                img.src = "data:image/png;base64," + data.images[0];
                img.style.display = "block";
                document.getElementById('placeholder').style.display = "none";
                document.getElementById('dlBtn').style.display = "block";
                addLog("SUCCESS");
            } catch(e) { addLog("TIMEOUT"); }
        }

        function downloadImg() {
            const a = document.createElement('a'); a.href = document.getElementById('mainImg').src;
            a.download = `nexus_${Date.now()}.png`; a.click();
        }
    </script>
</body>
</html>
