<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>NEXUS ARCHON</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0b0d10;
  --panel:#131722;
  --accent:#00ffe1;
  --text:#e6e6e6;
  --text-dim:#8b8f9a;
  --border:#1f2433;
}

*{box-sizing:border-box;font-family:Inter,system-ui,monospace}
body{
  margin:0;
  background:radial-gradient(circle at top,#121722,#07090d);
  color:var(--text);
  overflow:hidden;
}
header{
  height:60px;
  display:flex;
  align-items:center;
  padding:0 20px;
  border-bottom:1px solid var(--border);
  background:#0d1018;
}
header h1{
  font-size:14px;
  letter-spacing:3px;
  color:var(--accent);
}
main{
  display:grid;
  grid-template-columns:300px 1fr;
  height:calc(100vh - 60px);
}
aside{
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:15px;
  overflow:auto;
}
section{
  padding:15px;
  overflow:auto;
}
.module-box{
  border:1px solid var(--border);
  padding:12px;
  margin-bottom:14px;
}
.module-label{
  font-size:10px;
  letter-spacing:2px;
  color:var(--accent);
  display:block;
  margin-bottom:8px;
}
label{
  font-size:11px;
  color:var(--text-dim);
}
input,select,textarea,button{
  width:100%;
  margin:6px 0 10px;
  background:#0e1220;
  color:var(--text);
  border:1px solid var(--border);
  padding:6px;
}
button{
  cursor:pointer;
  background:linear-gradient(145deg,#00ffe1,#00c9b7);
  color:#00110e;
  font-weight:600;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:12px;
}
.art-card{
  border:1px solid var(--border);
  background:#0d1018;
}
.art-card img{
  width:100%;
  display:block;
}
</style>
</head>

<body>
<header>
  <h1>NEXUS ARCHON</h1>
</header>

<main>
<aside>

<div class="module-box">
  <span class="module-label">Prompt</span>
  <textarea id="prompt" rows="4" placeholder="Describe the image..."></textarea>
  <textarea id="negative" rows="2" placeholder="Negative prompt"></textarea>
</div>

<div class="module-box">
  <span class="module-label">Generation Dynamics</span>

  <label>Steps: <span id="stepsVal">25</span></label>
  <input type="range" min="5" max="60" value="25" id="steps">

  <label>CFG Scale: <span id="cfgVal">7</span></label>
  <input type="range" min="1" max="15" step="0.5" value="7" id="cfg">

  <label>Denoise (img2img): <span id="denoiseVal">0.55</span></label>
  <input type="range" min="0.1" max="0.9" step="0.05" value="0.55" id="denoise">

  <label>Seed</label>
  <input type="number" id="seed" placeholder="-1 = random">

  <label>Sampler</label>
  <select id="sampler">
    <option>Euler a</option>
    <option>DPM++ 2M Karras</option>
    <option>DPM++ SDE</option>
    <option>DDIM</option>
  </select>

  <label style="display:flex;gap:6px;align-items:center;">
    <input type="checkbox" id="useWorkshopImage">
    Use Workshop Image (img2img)
  </label>

  <button onclick="runRender()">EXECUTE RENDER</button>
</div>

</aside>

<section>
  <div class="grid" id="mainGrid"></div>
</section>
</main>

<script>
// ================= IMAGE VAULT (IndexedDB) =================
let vaultDB;
const VAULT_DB="nexus_image_vault";
const VAULT_STORE="images";

function initVault(){
  const req=indexedDB.open(VAULT_DB,1);
  req.onupgradeneeded=e=>{
    e.target.result.createObjectStore(VAULT_STORE,{keyPath:"id"});
  };
  req.onsuccess=e=>{
    vaultDB=e.target.result;
    restoreVault();
  };
}

function saveToVault(record){
  if(!vaultDB)return;
  const tx=vaultDB.transaction(VAULT_STORE,"readwrite");
  tx.objectStore(VAULT_STORE).put(record);
}

function restoreVault(){
  const tx=vaultDB.transaction(VAULT_STORE,"readonly");
  tx.objectStore(VAULT_STORE).getAll().onsuccess=e=>{
    e.target.result.forEach(r=>addArt(r.src,r.prompt,true,r.id));
  };
}

// ================= ART GRID =================
function addArt(src,p,restoring=false,id=null){
  const uid=id||crypto.randomUUID();

  if(!restoring){
    saveToVault({
      id:uid,
      src,
      prompt:p,
      time:Date.now(),
      parent:null
    });
  }

  const card=document.createElement("div");
  card.className="art-card";
  card.innerHTML=`
    <img src="${src}">
    <div style="padding:10px">
      <div style="font-size:10px;color:var(--accent)">ID ${uid.slice(0,8)}</div>
      <div style="font-size:11px;color:var(--text-dim)">${p.slice(0,60)}</div>
    </div>`;
  document.getElementById("mainGrid").prepend(card);
}

// ================= GENERATION =================
async function runRender(){
  const prompt=document.getElementById("prompt").value;
  const neg=document.getElementById("negative").value;

  const steps=+stepsEl.value;
  const cfg_scale=+cfgEl.value;
  const denoise=+denoiseEl.value;
  const sampler_name=samplerEl.value;
  const seedVal=seedEl.value;

  let payload={
    prompt,
    negative_prompt:neg,
    steps,
    cfg_scale,
    sampler_name,
    subseed_strength:0.15
  };

  if(seedVal) payload.seed=+seedVal;

  // ðŸ”´ MOCK GENERATION (replace with real API)
  const canvas=document.createElement("canvas");
  canvas.width=512; canvas.height=512;
  const ctx=canvas.getContext("2d");
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,512,512);
  ctx.fillStyle="#00ffe1";
  ctx.font="16px monospace";
  ctx.fillText("NEXUS RENDER",20,40);
  ctx.fillText(prompt.slice(0,40),20,80);

  addArt(canvas.toDataURL(),prompt);
}

// ================= UI POLISH =================
const stepsEl=steps;
const cfgEl=cfg;
const denoiseEl=denoise;

[stepsEl,cfgEl,denoiseEl].forEach(el=>{
  el.oninput=()=>{
    document.getElementById(el.id+"Val").innerText=el.value;
  };
});

// ================= INIT =================
window.onload=()=>{
  initVault();
};
</script>
</body>
</html>
